<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>My Profile | HabitUP</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="img/HLogo.jpg" rel="icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link crossorigin href="https://fonts.gstatic.com" rel="preconnect">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Raleway:wght@600;700&display=swap" rel="stylesheet">

  <!-- Bootstrap CSS -->
  <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" rel="stylesheet">

  <!-- Bootstrap Icons -->
  <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
        integrity="sha384-tViUnnbYAV00FLIhhi3v/dWt3Jxw4gZQcNoSCxCIFNJVCx7/D55/wXsrNIRANwdD" rel="stylesheet">

  <!-- AOS Animation -->
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="nav.css" rel="stylesheet">

  <style>
    :root {
      --primary-dark: #223b51;
      --primary-accent: #fdc134;
      --text-dark: #213b52;
      --text-light: #6c757d;
      --bg-light: #f8f9fa;
      --border-radius: 12px;
      --box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
      --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    body.profile-page {
      background-color: var(--bg-light);
      font-family: 'Poppins', sans-serif;
      color: var(--text-dark);
      padding-top: 80px;
    }

    .profile-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }

    /* Profile Header */
    .profile-header {
      background: linear-gradient(135deg, var(--primary-dark) 0%, #1a2f42 100%);
      border-radius: var(--border-radius);
      padding: 3rem 2rem;
      position: relative;
      margin-bottom: 2rem;
      box-shadow: var(--box-shadow);
      color: white;
      text-align: center;
      overflow: hidden;
    }

    .profile-avatar-container {
      position: relative;
      display: inline-block;
      margin-bottom: 1.5rem;
      z-index: 1;
    }

    .profile-avatar {
      width: 140px;
      height: 140px;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid var(--primary-accent);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      transition: var(--transition);
    }

    .avatar-edit {
      position: absolute;
      bottom: 10px;
      right: 10px;
      background: var(--primary-accent);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition);
      z-index: 2;
    }

    .avatar-edit:hover {
      transform: scale(1.1) rotate(10deg);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .profile-name {
      font-family: 'Raleway', sans-serif;
      font-weight: 700;
      font-size: 2rem;
      margin-bottom: 0.5rem;
      position: relative;
      z-index: 1;
    }

    .profile-badge {
      display: inline-block;
      padding: 0.5rem 1.25rem;
      border-radius: 50px;
      font-weight: 600;
      font-size: 0.9rem;
      background-color: rgba(255, 255, 255, 0.15);
      margin-top: 0.5rem;
      position: relative;
      z-index: 1;
    }

    /* Profile Content */
    .profile-content {
      display: grid;
      grid-template-columns: 1fr;
      gap: 2rem;
    }

    @media (min-width: 992px) {
      .profile-content {
        grid-template-columns: 1fr 1fr;
      }
    }

    .profile-card {
      background: white;
      border-radius: var(--border-radius);
      padding: 2rem;
      box-shadow: var(--box-shadow);
      position: relative;
      overflow: hidden;
      transition: var(--transition);
    }

    .profile-card h4 {
      font-family: 'Raleway', sans-serif;
      font-weight: 700;
      color: var(--primary-dark);
      margin-bottom: 1.5rem;
      padding-bottom: 0.75rem;
      border-bottom: 2px solid var(--primary-accent);
      display: flex;
      align-items: center;
    }

    .form-group {
      margin-bottom: 1.75rem;
    }

    .form-group label {
      font-weight: 500;
      margin-bottom: 0.5rem;
      display: block;
      color: var(--text-dark);
    }

    .form-control {
      border-radius: var(--border-radius);
      padding: 0.85rem 1.25rem;
      border: 1px solid #e0e3e6;
      transition: var(--transition);
    }

    .form-control:focus {
      border-color: var(--primary-accent);
      box-shadow: 0 0 0 0.25rem rgba(253, 193, 52, 0.2);
    }

    .readonly-field {
      background-color: var(--bg-light);
      padding: 0.85rem 1.25rem;
      border-radius: var(--border-radius);
      min-height: 50px;
      display: flex;
      align-items: center;
      border: 1px solid transparent;
    }

    /* Action Buttons */
    .action-buttons {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
      margin-top: 2rem;
    }

    .btn {
      border-radius: 50px;
      padding: 0.75rem 1.75rem;
      font-weight: 600;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .btn-edit {
      background-color: var(--primary-accent);
      color: var(--primary-dark);
    }

    .btn-save {
      background-color: #28a745;
      color: white;
    }

    .btn-cancel {
      background-color: white;
      color: var(--text-dark);
      border: 1px solid #e0e3e6;
    }

    /* Status Indicators */
    .status-badge {
      display: inline-flex;
      align-items: center;
      padding: 0.4rem 1rem;
      border-radius: 50px;
      font-weight: 500;
    }

    .status-active {
      background-color: #d4edda;
      color: #155724;
    }

    .status-inactive {
      background-color: #f8d7da;
      color: #721c24;
    }

    .subscription-badge {
      background-color: var(--primary-accent);
      color: var(--primary-dark);
    }

    /* Loading States */
    .loading-spinner {
      display: inline-block;
      width: 1rem;
      height: 1rem;
      border: 0.2em solid currentColor;
      border-right-color: transparent;
      border-radius: 50%;
      animation: spinner-border 0.75s linear infinite;
      margin-left: 0.5rem;
    }

    @keyframes spinner-border {
      to { transform: rotate(360deg); }
    }

    /* Edit Mode */
    .edit-mode .readonly-field {
      display: none;
    }

    .edit-mode .form-control {
      display: block;
      animation: fadeIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(5px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .form-control {
      display: none;
    }

    /* Toast Notification */
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
    }

    .toast {
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      overflow: hidden;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    .toast-success {
      background-color: #d4edda;
      color: #155724;
      border-left: 4px solid #28a745;
    }

    .toast-error {
      background-color: #f8d7da;
      color: #721c24;
      border-left: 4px solid #dc3545;
    }
  </style>
</head>

<body class="profile-page">
<!-- Toast Notification Container -->
<div class="toast-container" id="toastContainer"></div>

<!-- Header -->
<header class="header d-flex align-items-center fixed-top" id="header">
  <div class="container-fluid container-xl position-relative d-flex align-items-center">
    <a class="logo d-flex align-items-center me-auto" href="index.html">
      <h1 class="sitename">HabitUP</h1>
      <span>.</span>
    </a>
    <nav class="navmenu" id="navmenu">
      <ul>
        <li><a href="home.html">Home</a></li>
        <li><a href="#about">About</a></li>
        <li><a href="#featured-services">Services</a></li>
        <li><a href="#team">Team</a></li>
        <li><a href="#contact">Contact</a></li>
      </ul>
      <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
    </nav>
    <div class="dropdown ms-3">
      <img src="img/default-profile.jpg" alt="Profile" class="profile-img dropdown-toggle" id="profileDropdown" data-bs-toggle="dropdown" aria-expanded="false">
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown">
        <li><a class="dropdown-item" href="profile.html"><i class="bi bi-person me-2"></i>Profile</a></li>
        <li><a class="dropdown-item" href="dashboard.html"><i class="bi bi-speedometer2 me-2"></i>Dashboard</a></li>
        <li><hr class="dropdown-divider"></li>
        <li><a class="dropdown-item" href="#" id="logoutBtn"><i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
      </ul>
    </div>
  </div>
</header>

<main>
  <div class="profile-container">
    <!-- Profile Header -->
    <div class="profile-header" data-aos="fade-down">
      <div class="profile-avatar-container">
        <img src="img/default-profile.jpg" alt="Profile Photo" class="profile-avatar" id="profileAvatar">
        <div class="avatar-edit" id="avatarEditBtn">
          <i class="bi bi-camera-fill"></i>
        </div>
        <input type="file" id="avatarUpload" accept="image/*">
      </div>
      <h2 class="profile-name" id="profileName">Loading...</h2>
      <div class="profile-badge subscription-badge" id="subscriptionBadge">
        <i class="bi bi-star-fill me-1"></i>
        <span id="subscriptionTypeText">Loading...</span>
      </div>
    </div>

    <!-- Profile Content -->
    <div class="profile-content">
      <!-- Personal Information Card -->
      <div class="profile-card" data-aos="fade-right" data-aos-delay="100">
        <h4><i class="bi bi-person-circle me-2"></i>Personal Information</h4>

        <div class="form-group">
          <label>Email Address</label>
          <div class="readonly-field" id="emailField">Loading...</div>
        </div>

        <div class="form-group">
          <label>Full Name</label>
          <div class="readonly-field" id="nameField">Loading...</div>
          <input type="text" class="form-control" id="nameInput" maxlength="50">
        </div>

        <div class="form-group">
          <label>Date of Birth</label>
          <div class="readonly-field" id="dobField">Loading...</div>
          <input type="date" class="form-control" id="dobInput">
        </div>

        <div class="form-group">
          <label>Phone Number</label>
          <div class="readonly-field" id="phoneField">Loading...</div>
          <input type="tel" class="form-control" id="phoneInput" pattern="[0-9]{10}" maxlength="10">
        </div>

        <div class="form-group">
          <label>Gender</label>
          <div class="readonly-field" id="genderField">Loading...</div>
          <select class="form-control" id="genderSelect">
            <option value="MALE">Male</option>
            <option value="FEMALE">Female</option>
            <option value="OTHER">Other</option>
            <option value="PREFER_NOT_TO_SAY">Prefer not to say</option>
          </select>
        </div>
      </div>

      <!-- Account Information Card -->
      <div class="profile-card" data-aos="fade-left" data-aos-delay="100">
        <h4><i class="bi bi-shield-lock me-2"></i>Account Information</h4>

        <div class="form-group">
          <label>Member Since</label>
          <div class="readonly-field" id="joinDateField">Loading...</div>
        </div>

        <div class="form-group">
          <label>Account Status</label>
          <div class="readonly-field">
              <span class="status-badge status-active" id="statusField">
                <i class="bi bi-check-circle-fill me-1"></i>
                <span>Loading...</span>
              </span>
          </div>
        </div>

        <div class="form-group">
          <label>Subscription Plan</label>
          <div class="readonly-field">
              <span class="status-badge subscription-badge" id="subscriptionTypeField">
                <i class="bi bi-star-fill me-1"></i>
                <span>Loading...</span>
              </span>
          </div>
        </div>

        <div class="form-group">
          <label>User Type</label>
          <div class="readonly-field" id="userTypeField">Loading...</div>
        </div>

        <div class="form-group">
          <label>User ID</label>
          <div class="readonly-field" id="userIdField">Loading...</div>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons" data-aos="fade-up" data-aos-delay="200">
      <button class="btn btn-edit" id="editBtn">
        <i class="bi bi-pencil-square"></i> Edit Profile
      </button>
      <button class="btn btn-save" id="saveBtn" style="display: none;">
        <i class="bi bi-check-circle"></i>
        <span id="saveText">Save Changes</span>
        <span id="saveSpinner" style="display: none;" class="loading-spinner"></span>
      </button>
      <button class="btn btn-cancel" id="cancelBtn" style="display: none;">
        <i class="bi bi-x-circle"></i> Cancel
      </button>
    </div>
  </div>
</main>

<!-- Footer -->
<footer class="footer dark-background" id="footer">
  <div class="container">
    <h3 class="sitename">HabitUP</h3>
    <p>Your personalized path to better habits</p>
    <div class="social-links d-flex justify-content-center">
      <a href=""><i class="bi bi-twitter-x"></i></a>
      <a href=""><i class="bi bi-facebook"></i></a>
      <a href=""><i class="bi bi-instagram"></i></a>
      <a href=""><i class="bi bi-skype"></i></a>
      <a href=""><i class="bi bi-linkedin"></i></a>
    </div>
    <div class="copyright">
      <span>Copyright</span> <strong class="px-1 sitename">&copy; HabitUP</strong> <span>All Rights Reserved</span>
    </div>
    <div class="credits">
      Designed by <a href="#">FullStackFlair</a>
    </div>
  </div>
</footer>

<!-- Vendor JS Files -->
<script crossorigin="anonymous" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- AOS Animation -->
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
  AOS.init({
    duration: 600,
    easing: 'ease-out-quad',
    once: true
  });
</script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // DOM Elements
    const profileAvatar = document.getElementById('profileAvatar');
    const profileName = document.getElementById('profileName');
    const emailField = document.getElementById('emailField');
    const nameField = document.getElementById('nameField');
    const nameInput = document.getElementById('nameInput');
    const dobField = document.getElementById('dobField');
    const dobInput = document.getElementById('dobInput');
    const phoneField = document.getElementById('phoneField');
    const phoneInput = document.getElementById('phoneInput');
    const genderField = document.getElementById('genderField');
    const genderSelect = document.getElementById('genderSelect');
    const joinDateField = document.getElementById('joinDateField');
    const statusField = document.getElementById('statusField');
    const subscriptionTypeField = document.getElementById('subscriptionTypeField');
    const subscriptionTypeText = document.getElementById('subscriptionTypeText');
    const userTypeField = document.getElementById('userTypeField');
    const userIdField = document.getElementById('userIdField');
    const subscriptionBadge = document.getElementById('subscriptionBadge');
    const editBtn = document.getElementById('editBtn');
    const saveBtn = document.getElementById('saveBtn');
    const cancelBtn = document.getElementById('cancelBtn');
    const avatarEditBtn = document.getElementById('avatarEditBtn');
    const avatarUpload = document.getElementById('avatarUpload');
    const saveText = document.getElementById('saveText');
    const saveSpinner = document.getElementById('saveSpinner');
    const toastContainer = document.getElementById('toastContainer');
    const logoutBtn = document.getElementById('logoutBtn');

    // State
    let isEditMode = false;
    let originalValues = {};
    let userData = {};
    let newAvatarFile = null;

    // Initialize
    fetchUserProfile();

    // Event Listeners
    editBtn.addEventListener('click', enableEditMode);
    saveBtn.addEventListener('click', saveProfile);
    cancelBtn.addEventListener('click', cancelEdit);
    avatarEditBtn.addEventListener('click', () => avatarUpload.click());
    avatarUpload.addEventListener('change', handleAvatarUpload);
    logoutBtn.addEventListener('click', handleLogout);

    // Functions
    async function fetchUserProfile() {
      try {
        const email = localStorage.getItem('email');
        const token = localStorage.getItem('token');

        if (!email || !token) {
          throw new Error('Authentication required');
        }

        const response = await fetch(`http://localhost:8080/user/show-a-user/${email}`, {
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });

        if (!response.ok) {
          throw new Error('Failed to fetch user profile');
        }

        const data = await response.json();
        userData = data;

        // Update localStorage with fresh data
        updateLocalStorage(data);

        // Display the data
        displayUserData(data);

      } catch (error) {
        console.error('Error fetching user profile:', error);
        showToast('Failed to load profile data', 'error');
      }
    }

    function updateLocalStorage(data) {
      localStorage.setItem('userId', data.userId);
      localStorage.setItem('email', data.email);
      localStorage.setItem('name', data.name);
      localStorage.setItem('joinDate', data.joinDate);
      localStorage.setItem('dob', data.dob);
      localStorage.setItem('phoneNo', data.phoneNo);
      localStorage.setItem('accountStatus', data.accountStatus);
      localStorage.setItem('subscriptionType', data.subscriptionType);
      localStorage.setItem('profilePhoto', data.profilePhoto || '');
      localStorage.setItem('userType', data.userType);
      localStorage.setItem('gender', data.gender);
    }

    function displayUserData(data) {
      // Profile Avatar
      if (data.profilePhoto) {
        profileAvatar.src = data.profilePhoto;
      } else {
        profileAvatar.src = 'img/default-profile.jpg';
      }

      // Basic Info
      profileName.textContent = data.name || 'User';
      emailField.textContent = data.email || 'Not available';
      nameField.textContent = data.name || 'Not available';
      nameInput.value = data.name || '';

      // Date of Birth
      if (data.dob) {
        const dobDate = new Date(data.dob);
        dobField.textContent = dobDate.toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        });
        dobInput.value = data.dob;
      } else {
        dobField.textContent = 'Not set';
        dobInput.value = '';
      }

      // Phone Number
      if (data.phoneNo) {
        const phoneStr = data.phoneNo.toString();
        const formattedPhone = `+${phoneStr.substring(0,1)} (${phoneStr.substring(1,4)}) ${phoneStr.substring(4,7)}-${phoneStr.substring(7)}`;
        phoneField.textContent = formattedPhone;
        phoneInput.value = phoneStr;
      } else {
        phoneField.textContent = 'Not set';
        phoneInput.value = '';
      }

      // Gender
      genderField.textContent = formatGender(data.gender);
      genderSelect.value = data.gender || 'PREFER_NOT_TO_SAY';

      // Join Date
      if (data.joinDate) {
        const joinDate = new Date(data.joinDate);
        joinDateField.textContent = joinDate.toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        });
      } else {
        joinDateField.textContent = 'Not available';
      }

      // Account Status
      if (data.accountStatus) {
        statusField.innerHTML = `
          <i class="bi bi-${data.accountStatus === 'ACTIVE' ? 'check' : 'x'}-circle-fill me-1"></i>
          <span>${data.accountStatus}</span>
        `;
        statusField.className = data.accountStatus === 'ACTIVE' ?
          'status-badge status-active' : 'status-badge status-inactive';
      }

      // Subscription Type
      if (data.subscriptionType) {
        subscriptionTypeText.textContent = data.subscriptionType;
        subscriptionTypeField.innerHTML = `
          <i class="bi bi-${data.subscriptionType === 'PREMIUM' ? 'star' : 'person'}-fill me-1"></i>
          <span>${data.subscriptionType}</span>
        `;
        subscriptionBadge.className = 'profile-badge ' +
          (data.subscriptionType === 'PREMIUM' ? 'subscription-badge' : '');
      }

      // User Type
      if (data.userType) {
        userTypeField.textContent = data.userType;
      }

      // User ID
      if (data.userId) {
        userIdField.textContent = data.userId;
      }
    }

    function formatGender(gender) {
      if (!gender) return 'Not specified';
      switch(gender) {
        case 'MALE': return 'Male';
        case 'FEMALE': return 'Female';
        case 'OTHER': return 'Other';
        case 'PREFER_NOT_TO_SAY': return 'Prefer not to say';
        default: return gender;
      }
    }

    function enableEditMode() {
      isEditMode = true;
      document.body.classList.add('edit-mode');
      editBtn.style.display = 'none';
      saveBtn.style.display = 'inline-block';
      cancelBtn.style.display = 'inline-block';

      // Store original values in case of cancel
      originalValues = {
        name: nameInput.value,
        dob: dobInput.value,
        phoneNo: phoneInput.value,
        gender: genderSelect.value
      };
    }

    function cancelEdit() {
      isEditMode = false;
      document.body.classList.remove('edit-mode');
      editBtn.style.display = 'inline-block';
      saveBtn.style.display = 'none';
      cancelBtn.style.display = 'none';

      // Restore original values
      nameInput.value = originalValues.name;
      dobInput.value = originalValues.dob;
      phoneInput.value = originalValues.phoneNo;
      genderSelect.value = originalValues.gender;

      // Reset avatar changes
      newAvatarFile = null;
      if (userData.profilePhoto) {
        profileAvatar.src = userData.profilePhoto;
      } else {
        profileAvatar.src = 'img/default-profile.jpg';
      }
    }

    async function saveProfile() {
      // Validate inputs
      if (!nameInput.value.trim()) {
        showToast('Please enter your name', 'error');
        return;
      }

      if (!phoneInput.value.trim() || !/^\d{10}$/.test(phoneInput.value)) {
        showToast('Please enter a valid 10-digit phone number', 'error');
        return;
      }

      // Show loading state
      saveText.style.display = 'none';
      saveSpinner.style.display = 'inline-block';
      saveBtn.disabled = true;

      try {
        const email = localStorage.getItem('email');
        const token = localStorage.getItem('token');

        if (!email || !token) {
          throw new Error('Authentication required');
        }

        // Prepare form data
        const formData = new FormData();
        formData.append('name', nameInput.value.trim());
        formData.append('dob', dobInput.value);
        formData.append('phoneNo', phoneInput.value);
        formData.append('gender', genderSelect.value);

        // Add the new avatar file if it exists
        if (newAvatarFile) {
          formData.append('profilePhoto', newAvatarFile);
        }

        // Send update request
        const response = await fetch(`http://localhost:8080/user/updateuser/${email}`, {
          method: 'PUT',
          headers: {
            'Authorization': `Bearer ${token}`
          },
          body: formData
        });

        if (!response.ok) {
          throw new Error('Failed to update profile');
        }

        const updatedUser = await response.json();

        // Update local storage with the response
        updateLocalStorage(updatedUser);

        // Fetch fresh data from server to ensure consistency
        await fetchUserProfile();

        // Exit edit mode
        isEditMode = false;
        document.body.classList.remove('edit-mode');
        editBtn.style.display = 'inline-block';
        saveBtn.style.display = 'none';
        cancelBtn.style.display = 'none';

        // Reset avatar file
        newAvatarFile = null;

        // Show success message
        showToast('Profile updated successfully!', 'success');

      } catch (error) {
        console.error('Error updating profile:', error);
        showToast('Failed to update profile. Please try again.', 'error');
      } finally {
        // Reset button state
        saveText.style.display = 'inline-block';
        saveSpinner.style.display = 'none';
        saveBtn.disabled = false;
      }
    }

    function handleAvatarUpload(event) {
      const file = event.target.files[0];
      if (!file) return;

      // Validate file type
      if (!file.type.match('image.*')) {
        showToast('Please select an image file (JPEG, PNG)', 'error');
        return;
      }

      // Validate file size (2MB max)
      if (file.size > 2 * 1024 * 1024) {
        showToast('Image must be less than 2MB', 'error');
        return;
      }

      // Preview the image
      const reader = new FileReader();
      reader.onload = function(e) {
        profileAvatar.src = e.target.result;
        newAvatarFile = file; // Store for upload

        // If not in edit mode, enter edit mode
        if (!isEditMode) {
          enableEditMode();
        }
      };
      reader.readAsDataURL(file);
    }

    function showToast(message, type) {
      const toast = document.createElement('div');
      toast.className = `toast toast-${type} show`;
      toast.innerHTML = `
        <div class="toast-body d-flex align-items-center">
          <i class="bi bi-${type === 'success' ? 'check-circle' : 'exclamation-triangle'}-fill me-2"></i>
          <span>${message}</span>
        </div>
      `;

      toastContainer.appendChild(toast);

      // Remove toast after 5 seconds
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
      }, 5000);
    }

    function handleLogout() {
      localStorage.clear();
      window.location.href = 'index.html';
    }
  });
</script>
</body>
</html>